<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Attribute for functions run at program initialization (before main)."><meta name="keywords" content="rust, rustlang, rust-lang, constructor"><title>constructor in static_init - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc attr"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../static_init/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../static_init/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In static_init</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Attribute Macro <a href="index.html">static_init</a>::<wbr><a class="attr" href="#">constructor</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/static_init_macro/lib.rs.html#34">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust attr"><code>#[constructor]</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Attribute for functions run at program initialization (before main).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[constructor]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>initer () {
<span class="comment">// run before main start
</span>}</code></pre></div>
<p>The execution order of constructors is unspecified. Nevertheless on ELF plateform (linux, any unixes but mac) and
windows plateform a priority can be specified using the syntax <code>constructor(&lt;num&gt;)</code> where
<code>&lt;num&gt;</code> is a number included in the range [0 ; 2<sup>16</sup>-1].</p>
<p>Constructors with a priority of 65535 are run first (in unspecified order), then constructors
with priority 65534 are run …  then constructors
with priority number 0</p>
<p>An abscence of priority is equivalent to a priority of 0.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[constructor(<span class="number">0</span>)]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>first () {
<span class="comment">// run before main start
</span>}

<span class="attr">#[constructor(<span class="number">1</span>)]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>then () {
<span class="comment">// run before main start
</span>}</code></pre></div>
<h2 id="safety"><a href="#safety">Safety</a></h2>
<p>Any access to <em>raw statics</em> with an equal or lower
initialization priority will cause undefined behavior. (NB: usual static data and <em>lazy
statics</em> are always safe to access.</p>
<h2 id="about-rust-standard-library-runtime"><a href="#about-rust-standard-library-runtime">About rust standard library runtime</a></h2>
<p>During program constructions some functionnality of the standard library will be missing on
unixes:</p>
<ul>
<li>program argument as returned by <code>std::env::args</code> and environment variables as returned by
<code>std::env::vars</code> will be emty on unixes other than linux-gnu. On linux/gnu they will be
empty above priority</li>
</ul>
<ol start="65436">
<li></li>
</ol>
<ul>
<li>
<p>call to <code>std::thread::current</code> will panick.</p>
</li>
<li>
<p>standard streams may not be initialized.</p>
</li>
<li>
<p>Some signal handler installed by the standard library may not be installed</p>
</li>
</ul>
<p>On windows all the standard library should appear initialized.</p>
<h2 id="constructor-signature"><a href="#constructor-signature">Constructor signature</a></h2>
<p>Constructor function should have type <code>extern &quot;C&quot; fn() -&gt; ()</code>.</p>
<p>On plateform where the program is linked
with the gnu variant of libc (which covers all gnu variant platforms) constructor functions
can take (or not) <code>argc: i32, argv: **const u8, env: **const u8</code> as arguments.
<code>argc</code> is the size of the argv
sequence, <code>argv</code> and <code>env</code> both refer to null terminated contiguous sequence of pointer
to c-string (c-strings are null terminated sequence of u8).</p>
<p>Also after the null terminating <code>*const * const u8</code> of the environment variable list is found
the auxilary vector that are information provided by the kernel. It is possible to retrieve
from that vector information about the process and location of syscalls implemented in the
vdso.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[constructor]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>get_args_env(argc: i32, <span class="kw-2">mut </span>argv: <span class="kw-2">*const *const </span>u8, env: <span class="kw-2">*const *const </span>u8) {}</code></pre></div>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="static_init" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>