<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Integration of the GRANDPA finality gadget into substrate."><meta name="keywords" content="rust, rustlang, rust-lang, sc_consensus_grandpa"><title>sc_consensus_grandpa - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../sc_consensus_grandpa/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../sc_consensus_grandpa/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate sc_consensus_grandpa</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.10.0-dev</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">sc_consensus_grandpa</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/sc_consensus_grandpa/lib.rs.html#19-1191">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Integration of the GRANDPA finality gadget into substrate.</p>
<p>This crate is unstable and the API and usage may change.</p>
<p>This crate provides a long-running future that produces finality notifications.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>First, create a block-import wrapper with the <code>block_import</code> function. The
GRANDPA worker needs to be linked together with this block import object, so
a <code>LinkHalf</code> is returned as well. All blocks imported (from network or
consensus or otherwise) must pass through this wrapper, otherwise consensus
is likely to break in unexpected ways.</p>
<p>Next, use the <code>LinkHalf</code> and a local configuration to <code>run_grandpa_voter</code>.
This requires a <code>Network</code> implementation. The returned future should be
driven to completion and will finalize blocks in the background.</p>
<h2 id="changing-authority-sets"><a href="#changing-authority-sets">Changing authority sets</a></h2>
<p>The rough idea behind changing authority sets in GRANDPA is that at some point,
we obtain agreement for some maximum block height that the current set can
finalize, and once a block with that height is finalized the next set will
pick up finalization from there.</p>
<p>Technically speaking, this would be implemented as a voting rule which says,
“if there is a signal for a change in N blocks in block B, only vote on
chains with length NUM(B) + N if they contain B”. This conditional-inclusion
logic is complex to compute because it requires looking arbitrarily far
back in the chain.</p>
<p>Instead, we keep track of a list of all signals we’ve seen so far (across
all forks), sorted ascending by the block number they would be applied at.
We never vote on chains with number higher than the earliest handoff block
number (this is num(signal) + N). When finalizing a block, we either apply
or prune any signaled changes based on whether the signaling block is
included in the newly-finalized chain.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="report/index.html" title="sc_consensus_grandpa::report mod">report</a></div><div class="item-right docblock-short">Contains a number of data transfer objects for reporting data to the outside world.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="warp_proof/index.html" title="sc_consensus_grandpa::warp_proof mod">warp_proof</a></div><div class="item-right docblock-short">Utilities for generating and verifying GRANDPA warp sync proofs.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AuthoritySet.html" title="sc_consensus_grandpa::AuthoritySet struct">AuthoritySet</a></div><div class="item-right docblock-short">A set of authorities.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AuthoritySetChanges.html" title="sc_consensus_grandpa::AuthoritySetChanges struct">AuthoritySetChanges</a></div><div class="item-right docblock-short">Tracks historical authority set changes. We store the block numbers for the last block
of each authority set, once they have been finalized. These blocks are guaranteed to
have a justification unless they were triggered by a forced change.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AuthoritySetHardFork.html" title="sc_consensus_grandpa::AuthoritySetHardFork struct">AuthoritySetHardFork</a></div><div class="item-right docblock-short">A descriptor for an authority set hard fork. These are authority set changes
that are not signalled by the runtime and instead are defined off-chain
(hence the hard fork).</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BeforeBestBlockBy.html" title="sc_consensus_grandpa::BeforeBestBlockBy struct">BeforeBestBlockBy</a></div><div class="item-right docblock-short">A custom voting rule that guarantees that our vote is always behind the best
block by at least N blocks, unless the base number is &lt; N blocks behind the
best, in which case it votes for the base.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="sc_consensus_grandpa::Config struct">Config</a></div><div class="item-right docblock-short">Configuration for the GRANDPA service</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FinalityProof.html" title="sc_consensus_grandpa::FinalityProof struct">FinalityProof</a></div><div class="item-right docblock-short">Finality for block B is proved by providing:</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FinalityProofProvider.html" title="sc_consensus_grandpa::FinalityProofProvider struct">FinalityProofProvider</a></div><div class="item-right docblock-short">Finality proof provider for serving network requests.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GrandpaBlockImport.html" title="sc_consensus_grandpa::GrandpaBlockImport struct">GrandpaBlockImport</a></div><div class="item-right docblock-short">A block-import handler for GRANDPA.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GrandpaJustification.html" title="sc_consensus_grandpa::GrandpaJustification struct">GrandpaJustification</a></div><div class="item-right docblock-short">A GRANDPA justification for block finality, it includes a commit message and
an ancestry proof including all headers routing all precommit target blocks
to the commit target block. Due to the current voting strategy the precommit
targets should be the same as the commit target, since honest voters don’t
vote past authority set change blocks.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GrandpaParams.html" title="sc_consensus_grandpa::GrandpaParams struct">GrandpaParams</a></div><div class="item-right docblock-short">Parameters used to run Grandpa.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LinkHalf.html" title="sc_consensus_grandpa::LinkHalf struct">LinkHalf</a></div><div class="item-right docblock-short">Link between the block importer and the background voter.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ScheduledChange.html" title="sc_consensus_grandpa::ScheduledChange struct">ScheduledChange</a></div><div class="item-right docblock-short">A scheduled change of authority set.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SharedAuthoritySet.html" title="sc_consensus_grandpa::SharedAuthoritySet struct">SharedAuthoritySet</a></div><div class="item-right docblock-short">A shared authority set.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SharedVoterState.html" title="sc_consensus_grandpa::SharedVoterState struct">SharedVoterState</a></div><div class="item-right docblock-short">Shared voter state for querying.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ThreeQuartersOfTheUnfinalizedChain.html" title="sc_consensus_grandpa::ThreeQuartersOfTheUnfinalizedChain struct">ThreeQuartersOfTheUnfinalizedChain</a></div><div class="item-right docblock-short">A custom voting rule that limits votes towards 3/4 of the unfinalized chain,
using the given <code>base</code> and <code>best_target</code> to figure where the 3/4 target
should fall.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.VotingRulesBuilder.html" title="sc_consensus_grandpa::VotingRulesBuilder struct">VotingRulesBuilder</a></div><div class="item-right docblock-short">A builder of a composite voting rule that applies a set of rules to
progressively restrict the vote.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="sc_consensus_grandpa::Error enum">Error</a></div><div class="item-right docblock-short">Errors that can occur while voting in GRANDPA.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.FinalityProofError.html" title="sc_consensus_grandpa::FinalityProofError enum">FinalityProofError</a></div><div class="item-right docblock-short">Errors occurring when trying to prove finality</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.BlockNumberOps.html" title="sc_consensus_grandpa::BlockNumberOps trait">BlockNumberOps</a></div><div class="item-right docblock-short">Arithmetic necessary for a block number.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ClientForGrandpa.html" title="sc_consensus_grandpa::ClientForGrandpa trait">ClientForGrandpa</a></div><div class="item-right docblock-short">A trait that includes all the client functionalities grandpa requires.
Ideally this would be a trait alias, we’re not there yet.
tracking issue <a href="https://github.com/rust-lang/rust/issues/41517">https://github.com/rust-lang/rust/issues/41517</a></div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.GenesisAuthoritySetProvider.html" title="sc_consensus_grandpa::GenesisAuthoritySetProvider trait">GenesisAuthoritySetProvider</a></div><div class="item-right docblock-short">Provider for the Grandpa authority set configured on the genesis block.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.GrandpaApi.html" title="sc_consensus_grandpa::GrandpaApi trait">GrandpaApi</a></div><div class="item-right docblock-short">APIs for integrating the GRANDPA finality gadget into runtimes.
This should be implemented on the runtime side.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.VotingRule.html" title="sc_consensus_grandpa::VotingRule trait">VotingRule</a></div><div class="item-right docblock-short">A trait for custom voting rules in GRANDPA.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.best_justification.html" title="sc_consensus_grandpa::best_justification fn">best_justification</a></div><div class="item-right docblock-short">Fetch the justification for the latest block finalized by GRANDPA, if any.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.block_import.html" title="sc_consensus_grandpa::block_import fn">block_import</a></div><div class="item-right docblock-short">Make block importer and link half necessary to tie the background voter
to it.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.block_import_with_authority_set_hard_forks.html" title="sc_consensus_grandpa::block_import_with_authority_set_hard_forks fn">block_import_with_authority_set_hard_forks</a></div><div class="item-right docblock-short">Make block importer and link half necessary to tie the background voter to
it. A vector of authority set hard forks can be passed, any authority set
change signaled at the given block (either already signalled or in a further
block when importing it) will be replaced by a standard change with the
given static authorities.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.find_forced_change.html" title="sc_consensus_grandpa::find_forced_change fn">find_forced_change</a></div><div class="item-right docblock-short">Checks the given header for a consensus digest signalling a <strong>forced</strong> scheduled change and
extracts it.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.find_scheduled_change.html" title="sc_consensus_grandpa::find_scheduled_change fn">find_scheduled_change</a></div><div class="item-right docblock-short">Checks the given header for a consensus digest signalling a <strong>standard</strong> scheduled change and
extracts it.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.grandpa_peers_set_config.html" title="sc_consensus_grandpa::grandpa_peers_set_config fn">grandpa_peers_set_config</a></div><div class="item-right docblock-short">Returns the configuration value to put in
<a href="../sc_network/config/struct.NetworkConfiguration.html#structfield.extra_sets" title="sc_network::config::NetworkConfiguration::extra_sets"><code>sc_network::config::NetworkConfiguration::extra_sets</code></a>.
For standard protocol name see <a href="fn.protocol_standard_name.html" title="crate::protocol_standard_name"><code>crate::protocol_standard_name</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.protocol_standard_name.html" title="sc_consensus_grandpa::protocol_standard_name fn">protocol_standard_name</a></div><div class="item-right docblock-short">Name of the notifications protocol used by GRANDPA.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.revert.html" title="sc_consensus_grandpa::revert fn">revert</a></div><div class="item-right docblock-short">Reverts protocol aux data to at most the last finalized block.
In particular, standard and forced authority set changes announced after the
revert point are removed.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.run_grandpa_observer.html" title="sc_consensus_grandpa::run_grandpa_observer fn">run_grandpa_observer</a></div><div class="item-right docblock-short">Run a GRANDPA observer as a task, the observer will finalize blocks only by
listening for and validating GRANDPA commits instead of following the full
protocol. Provide configuration and a link to a block import worker that has
already been instantiated with <code>block_import</code>.
NOTE: this is currently not part of the crate’s public API since we don’t consider
it stable enough to use on a live network.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.run_grandpa_voter.html" title="sc_consensus_grandpa::run_grandpa_voter fn">run_grandpa_voter</a></div><div class="item-right docblock-short">Run a GRANDPA voter as a task. Provide configuration and a link to a
block import worker that has already been instantiated with <code>block_import</code>.</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.AuthorityId.html" title="sc_consensus_grandpa::AuthorityId type">AuthorityId</a></div><div class="item-right docblock-short">Identity of a Grandpa authority.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.AuthorityPair.html" title="sc_consensus_grandpa::AuthorityPair type">AuthorityPair</a></div><div class="item-right docblock-short">The grandpa crypto scheme defined via the keypair type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.CatchUp.html" title="sc_consensus_grandpa::CatchUp type">CatchUp</a></div><div class="item-right docblock-short">A catch up message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Commit.html" title="sc_consensus_grandpa::Commit type">Commit</a></div><div class="item-right docblock-short">A commit message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.CompactCommit.html" title="sc_consensus_grandpa::CompactCommit type">CompactCommit</a></div><div class="item-right docblock-short">A compact commit message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.GrandpaJustificationSender.html" title="sc_consensus_grandpa::GrandpaJustificationSender type">GrandpaJustificationSender</a></div><div class="item-right docblock-short">The sending half of the Grandpa justification channel(s).</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.GrandpaJustificationStream.html" title="sc_consensus_grandpa::GrandpaJustificationStream type">GrandpaJustificationStream</a></div><div class="item-right docblock-short">The receiving half of the Grandpa justification channel.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Message.html" title="sc_consensus_grandpa::Message type">Message</a></div><div class="item-right docblock-short">A GRANDPA message for a substrate chain.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Precommit.html" title="sc_consensus_grandpa::Precommit type">Precommit</a></div><div class="item-right docblock-short">A precommit message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Prevote.html" title="sc_consensus_grandpa::Prevote type">Prevote</a></div><div class="item-right docblock-short">A prevote message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.PrimaryPropose.html" title="sc_consensus_grandpa::PrimaryPropose type">PrimaryPropose</a></div><div class="item-right docblock-short">A primary propose message for this chain’s block type.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.SignedMessage.html" title="sc_consensus_grandpa::SignedMessage type">SignedMessage</a></div><div class="item-right docblock-short">A signed message.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.VotingRuleResult.html" title="sc_consensus_grandpa::VotingRuleResult type">VotingRuleResult</a></div><div class="item-right docblock-short">A future returned by a <code>VotingRule</code> to restrict a given vote, if any restriction is necessary.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="sc_consensus_grandpa" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>