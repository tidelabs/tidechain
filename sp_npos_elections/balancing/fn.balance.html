<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Balance the weight distribution of a given `voters` at most `iterations` times, or up until the point where the biggest difference created per iteration of all stakes is `tolerance`. If this is called with `tolerance = 0`, then exactly `iterations` rounds will be executed, except if no change has been made (`difference = 0`). `tolerance` and `iterations` are part of the [`BalancingConfig`] struct."><meta name="keywords" content="rust, rustlang, rust-lang, balance"><title>balance in sp_npos_elections::balancing - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../sp_npos_elections/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../sp_npos_elections/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In sp_npos_elections::balancing</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="../index.html">sp_npos_elections</a>::<wbr><a href="index.html">balancing</a>::<wbr><a class="fn" href="#">balance</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/sp_npos_elections/balancing.rs.html#58-81">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="item-decl"><pre class="rust fn"><code>pub fn balance&lt;AccountId:&nbsp;<a class="trait" href="../traits/trait.IdentifierT.html" title="trait sp_npos_elections::traits::IdentifierT">IdentifierT</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;voters: &amp;mut <a class="struct" href="https://doc.rust-lang.org/1.66.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../struct.Voter.html" title="struct sp_npos_elections::Voter">Voter</a>&lt;AccountId&gt;&gt;,<br>&nbsp;&nbsp;&nbsp;&nbsp;config: &amp;<a class="struct" href="../struct.BalancingConfig.html" title="struct sp_npos_elections::BalancingConfig">BalancingConfig</a><br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.66.1/std/primitive.usize.html">usize</a></code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Balance the weight distribution of a given <code>voters</code> at most <code>iterations</code> times, or up until the
point where the biggest difference created per iteration of all stakes is <code>tolerance</code>. If this
is called with <code>tolerance = 0</code>, then exactly <code>iterations</code> rounds will be executed, except if no
change has been made (<code>difference = 0</code>). <code>tolerance</code> and <code>iterations</code> are part of the
<a href="../struct.BalancingConfig.html" title="BalancingConfig"><code>BalancingConfig</code></a> struct.</p>
<p>In almost all cases, a balanced solution will have a better score than an unbalanced solution,
yet this is not 100% guaranteed because the first element of a <a href="../struct.ElectionScore.html" title="crate::ElectionScore"><code>crate::ElectionScore</code></a> does not
directly relate to balancing.</p>
<p>Note that some reference implementation adopt an approach in which voters are balanced randomly
per round. To advocate determinism, we don’t do this. In each round, all voters are exactly
balanced once, in the same order.</p>
<p>Also, note that due to re-distribution of weights, the outcome of this function might contain
edges with weight zero. The call site should filter such weight if desirable. Moreover, the
outcome might need balance re-normalization, see <code>Voter::try_normalize</code>.</p>
<h4 id="references"><a href="#references">References</a></h4>
<ul>
<li><a href="https://dl.acm.org/doi/10.1145/48014.61051">A new approach to the maximum flow problem</a>.</li>
<li><a href="https://arxiv.org/abs/2004.12990">Validator election in nominated proof-of-stake</a> (Appendix
A.)</li>
<li><a href="https://research.web3.foundation/en/latest/polkadot/NPoS/3.%20Balancing.html">Computing a balanced solution</a>,
which contains the details of the algorithm implementation.</li>
</ul>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="sp_npos_elections" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.1 (90743e729 2023-01-10)" ></div></body></html>